version: '2.4'

services:
  gateway-service:
    build: ./gateway-service
    restart: unless-stopped
    network_mode: host
    ports:
      - "4467:4467"
      - "1680:1680"
    volumes:
      - gateway-data:/etc/helium_gateway
      - gateway-logs:/var/log
    devices:
      - "/dev/i2c-1:/dev/i2c-1"
      - "/dev/gpiomem:/dev/gpiomem"
      - "/dev/spidev0.0:/dev/spidev0.0:rwm"  # 游녣 햆뤯놣냻뉋 SPI
    cap_add: [SYS_RAWIO]
    environment:
      - GW_REGION=EU868
      - ECC_CHIP=True
    labels:
      io.balena.features.balena-api: '1'
      io.balena.features.supervisor-api: '1'

  gwmp-mux:
    build: ./gwmp-mux
    restart: unless-stopped
    network_mode: host
    environment:
      RUST_LOG: info

  packet-forwarder:
    image: rakwireless/udp-packet-forwarder:latest
    restart: unless-stopped
    privileged: true
    network_mode: host
    environment:
      MODEL: "RAK2287"
      CONCENTRATOR: "SX1302"
      INTERFACE: "SPI"
      HAS_GPS: 0
      HAS_LTE: 0
      RESET_GPIO: 0    # 游녣 먫뤯럟돯뢇 햫햟 0 (disable GPIO  packet-forwarder)
      POWER_EN_GPIO: 0 # 游녣 먫뤯럟돯뢇 햫햟 0 (disable GPIO  packet-forwarder)
      RADIO_DEV: "/dev/spidev0.0"
      SPI_SPEED: 8000000
      STARTUP_DELAY: 30  # 游녣 햒뉋돯햊햖햊 향햟 햢햟 혜햣 햦햫햦혡햦햟햩햦향햦햟 GPIO 혥쒫
      BAND: "eu_863_870"
      SERVER_HOST: "127.0.0.1"
      SERVER_PORT: 1700
      GPS_LATITUDE: "41.2256"
      GPS_LONGITUDE: "25.535"
      GPS_ALTITUDE: "200"

volumes:
  gateway-data:
  gateway-logs:
      RESET_GPIO: 17
      POWER_EN_GPIO: 18
      RADIO_DEV: "/dev/spidev0.0"
      SPI_SPEED: 8000000
      STARTUP_DELAY: 15
      BAND: "eu_863_870"
      SERVER_HOST: "127.0.0.1"    # 游녣 먫뤯럟돯뢇돯뢇 햫햟 localhost
      SERVER_PORT: 1700
      GPS_LATITUDE: "41.2256"
      GPS_LONGITUDE: "25.535"
      GPS_ALTITUDE: "200"

volumes:
  gateway-data:
  gateway-logs: